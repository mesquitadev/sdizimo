{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SDízimo {% if titulo_relatorio %} - {{ titulo_relatorio }}{% endif %}</title>
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}">
    <!-- Normalize or reset CSS with your favorite library -->
    <link rel="stylesheet" href="{% static 'css/normalize.min.css' %}">
    <!-- Load paper.css for happy printing -->
    <link rel="stylesheet" href="{% static 'css/paper.css' %}">

    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.blue.css' %}" id="theme-stylesheet">
    <!-- Set page size here: A5, A4 or A3 -->
    <!-- Set also "landscape" if you need -->
    <style>
      body.A7 .sheet { width: 79mm; height: 105mm }
      .sheet.padding-5mm { padding: 5mm }
      .rodape {
        font-size: 0.85em;
      }
      .conteudo {
        font-size: 0.9em;
      }
      @page {
        size: A4;
      }
      .sheet {
        overflow: visible;
        height: auto !important;
      }
      h5 {
        padding: 10px 0;
        border-bottom: 2px solid #e9ecef;
      }
    </style>
  </head>

  <!-- Set "A5", "A4" or "A3" for class name -->
  <!-- Set also "landscape" if you need -->
  <body class="A7">
    <!-- Each sheet element should have the class "sheet" -->
    <!-- "padding-**mm" is optional: you can set 10, 15, 20 or 25 -->
    <section class="sheet padding-5mm">
      <h5 pb-4>
        <strong>{{paroquia.nome}}</strong><br>
        <small>{{paroquia.endereco}}.<br>Tel.: {{paroquia.telefone}}</small>
      </h5>
      <div class="mt-4 mb-3 text-center">
          RECIBO
      </div>
      <div class="conteudo mt-1">
        {% block content %}{% endblock %}
      </div>

      <footer class="rodape border border-right-0 border-left-0 border-bottom-0 mt-4 pt-1">
        <small>Emitido em {% now 'SHORT_DATETIME_FORMAT' %}.</small>
      </footer>
    </section>
  </body>
</html>

<script type="text/javascript" src="{% static 'qz/dependencies/rsvp-3.1.0.min.js' %}"></script>
<script type="text/javascript" src="{% static 'qz/dependencies/sha-256.min.js' %}"></script>
<script type="text/javascript" src="{% static 'qz/qz-tray.js' %}"></script>
<script type="text/javascript">
  //window.onload = function() { window.print(); }

  /*
  qz.websocket.connect().then(function() {
    console.log("Connected!");

    qz.printers.find("daruma").then(function(found) {
      console.log("Printer: " + found);
    });
  });
  */

  var map={"â":"a","Â":"A","à":"a","À":"A","á":"a","Á":"A","ã":"a","Ã":"A","ê":"e","Ê":"E","è":"e","È":"E","é":"e","É":"E","î":"i","Î":"I","ì":"i","Ì":"I","í":"i","Í":"I","õ":"o","Õ":"O","ô":"o","Ô":"O","ò":"o","Ò":"O","ó":"o","Ó":"O","ü":"u","Ü":"U","û":"u","Û":"U","ú":"u","Ú":"U","ù":"u","Ù":"U","ç":"c","Ç":"C"};

  function removerAcentos(s){ return s.replace(/[\W\[\] ]/g,function(a){return map[a]||a}) };

  qz.websocket.connect().then(function() {
    return qz.printers.find("daruma")               // Pass the printer name into the next Promise
  }).then(function(printer) {
    var config = qz.configs.create(printer);       // Create a default config for the found printer
    var cabecalho = removerAcentos(
      '------------------------------------------------\n' +
      '{{paroquia.nome|escapejs}}\n' +
      '{{paroquia.endereco|escapejs}}.\n' +
      'Tel.: {{paroquia.telefone|escapejs}}\n' +
      '------------------------------------------------\n' +
      '\n' +
      '                    RECIBO\n' +
      '\n'
    );
    var texto = removerAcentos({% block recibo_raw %}{% endblock %});
    var rodape = removerAcentos(
      '\n' +
      '------------------------------------------------\n' +
      "Emitido em {% now 'SHORT_DATETIME_FORMAT' %}\n" +
      '\n\n\n\n\n\n\n\n'
    );
    var data = [
      cabecalho,
      texto,
      rodape
    ];
    return qz.print(config, data);
  }).catch(function(e) { console.error(e); });
</script>
